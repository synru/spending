<head>
  <!-- Load plotly.js into the DOM -->
  <script src='https://cdn.plot.ly/plotly-2.14.0.min.js'></script>
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
</head>

<body>
  <script src="Weekly Spent by Category and Sub Category.js"></script>
  <div id='demo'></div>
  <div id='myDiv'>
    <!-- Plotly chart will be drawn inside this DIV -->
  </div>
  <script>
    const res = d3.csvParse(data);
    delete res["columns"];
    var subcats = res.map(item => item['Sub Category']);
    var cats = res.map((item, index) => subcats[index] == item['Category'] ? "" : item['Category']);
    var weeklySpent = res.map(item => parseFloat(item['Weekly Spent'].replace(/[£,]+/g, "")));

    var uniqueCats = [...new Set(cats)].filter(cat => !subcats.includes(cat) && cat != "")

    var labels = subcats.concat(uniqueCats)

    var values = weeklySpent.concat(uniqueCats.map((cat, index) => res.filter(item => item["Category"] == cat).map(item => parseFloat(item['Weekly Spent'].replace(/[£,]+/g, ""))).reduce((partialSum, a) => partialSum + a, 0)));
    var parents = cats.concat(new Array(uniqueCats.length).fill(""))

    //var labels = ["Eve", "Cain", "Seth", "Enos", "Noam", "Abel", "Awan", "Enoch", "Azura"]
    //var parents = ["", "Eve", "Eve", "Seth", "Seth", "Eve", "Eve", "Awan", "Eve"]
    var data = [{
      type: "treemap",
      parents: parents,
      labels: labels,
      values: values,
      //textinfo: "label+value+percent parent+percent entry",
      textinfo: "label",
      domain: { "x": [0, 1] },
      outsidetextfont: { "size": 20, "color": "#377eb8" },
      marker: { "line": { "width": 0 }   },
      pathbar: { "visible": false },
      //count: "branches+leaves",
      branchvalues: "total",
      hovertemplate: "%{label}: £%{value:.2f}"
    }];
    var layout = {
      annotations: [{
        showarrow: false,
        text: "Weekly Spending",
        x: 0.25,
        xanchor: "center",
        y: 1.1,
        yanchor: "bottom"
      }]
    }
    console.log(data)
    Plotly.newPlot('myDiv', data, layout)
  </script>
</body>